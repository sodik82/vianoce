<!DOCTYPE HTML>
<!-- (c) Sodik, 2015
-->
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Vianoce</title>
<link rel="stylesheet/less" type="text/css" href="styles.less" />
<script src="less.js" type="text/javascript"></script>
<script type="text/javascript" src="//code.jquery.com/jquery-latest.min.js"></script>
<script>
var zelanie = "StastneVesele";

function moveStar(name, x, y)
{
  var el = document.getElementById(name);
  el.style.position="absolute";
  el.style.top=y;
  el.style.left=x;
  el.style.width="50px";
  el.style.height="50px";
}

function createStar(name, text, color, scale)
{
  var el = document.getElementById("star");
  var star = el.cloneNode(false);
  star.id = name;
  var html = el.innerHTML;
  html = html.replace("S", text);
  html = html.replace("yellow", color);
  html = html.replace("0.25", scale);
  star.innerHTML = html;
  document.getElementById("canvas").appendChild(star);
}

function makeTree(levels)
{
  var el = document.getElementById("tree");
  var html = el.innerHTML;
  var points = "";
  var top = "" + compX(0) + "," + compY(0);
  // start with top
  points = top;
  end = top;
  var centerX = compX(0);
  for(var i = 0; i < levels; i++) {
    var idx = 1 + 2*i;
    var leftX = compX(idx);
    var leftY = compY(idx);
    points += " " + leftX + "," + leftY;
    points += " " + (centerX - 20) + "," + leftY;
    idx = 2 + 2*i;
    var rightX = compX(idx);
    var rightY = compY(idx);
    end = rightX + "," + rightY + " " + end;
    end = (centerX + 20) + "," + rightY + " " + end;
    makeBalls(leftX + 20, rightX - 20, leftY);
  }
  // merge "left" and right side
  points += " " + end;
  html = html.replace("99,99", points);
  // sprav aj pen
  html = html.replace("888", "" + (compX(0)-20));
  html = html.replace("777", "" + compY(idx));
  el.innerHTML = html;
}

function makeBalls(fromX, toX, baseY) {
  var count = (toX - fromX) / 80;
  if (count < 1) { count = 1; }
  for (var i = 0; i < Math.floor(count); i++) {
    var ball = $($(".gula1")[0]).clone();
    var x = Math.floor(Math.random() * 40) + fromX + i * 80 + 10;
    var y = baseY;
    var delay = Math.floor(Math.random() * 5);
    var duration = Math.floor(Math.random() * 8) + 7;
    ball.css({left: x, top: y});
    ball.css("-webkit-animation-delay", delay+"s");
    ball.css("animation-delay", delay+"s");
    ball.css("-webkit-animation-duration", duration+"s");
    ball.css("animation-duration", duration+"s");
    $("#canvas").append(ball);
  }
}

function compX(idx) {
  var x = 300, dx = 0;
  if (idx > 0) {
    dx = Math.floor((idx + 1) / 2) * 40;
    if (idx % 2 == 1) dx = -dx;
  }
  return Math.floor(x + dx);
}

function compY(idx) {
  return Math.floor(50 + Math.pow(Math.floor((idx + 1) / 2), 1.1) * 50);
}

var dears = [];
function makeDears() {
  var i;
  for(i=0; i<7;i++) {
    dears.push(makeDeer(i));
  }
}

function makeDeer(idx) {
  var top = 60 * idx;
  var $d = $('<div class="deer" style="top: '+top+'px"/>');
  $("body").append($d);
  $d.hover(function(){
    selectDeer(idx);
  }, function(){
    selectDeer(-1);
  });
  return $d;
}

function selectDeer(idx) {
  $(".deer").removeClass("up");
  if (idx < 0) {
    return;
  }
  $($(".deer")[idx]).addClass("up");
  var s = [ 18, 21, 4, 15, 12, 16, 8];
  var value = s[idx];
  for(var i=0; i<6; i++) {
    if (value % 2 == 1) {
      $($(".deer")[indx(idx,i)]).addClass("up");
      value--;
    }
    value = value / 2;
  }
}

function indx(idx, i) {
  return i < idx ? i : i + 1;
}

function onLoad() {
  makeTree(6);
  tick(0);
}

function tick(idx) {
  var name = "star"+idx;
  if (idx >= zelanie.length) {
    $("#podpis").show("slow");
    return;
  }
  createStar(name, zelanie.charAt(idx), "yellow", "0.25");
  moveStar(name, (compX(idx)-20)+"px", (compY(idx)-20)+"px");
  setTimeout("tick("+(idx+1)+")", 700);
}
</script>
<style>
  body {
    background-color: #5555FF;
  }
  #canvas {
    width: 640px;
    height: 450px;
    position: relative;
    margin: 50px auto 0px auto;
  }
  #tree svg {
    width: 640px;
    height: 450px;
  }
</style>
<script>
  $(onLoad);
</script>
</head>
<body>
<div id="canvas">

<div id="star" style="position: absolute; left: -1000px;">
<svg xmlns="http://www.w3.org/2000/svg" >
  <g transform="scale(0.25)">
  <polygon points="100,10 40,180 190,60 10,60 160,180" style="fill:yellow;stroke:black;"/>
  <text x="85" y="110" font-size="55" fill="red">S</text>
  </g>
</svg>
</div>

<svg id="podpis" style="position: absolute; top: 250px; left: 110px;width: 300px; height: 150px; z-index:10; display:none;" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink">
  <defs>
    <path id="pathx" d="M75,20 a1,1 0 0,0 100,0" />
  </defs>
  <text x="10" y="100" transform="scale(1.5)" style="fill:red;">
    <textPath xlink:href="#pathx">podarilo sa ti to dat</textPath>
  </text>
</svg>
<!-- stromcek -->
<div id="tree">
<svg xmlns="http://www.w3.org/2000/svg" >
  <polygon points="99,99" style="fill:green" />
  <rect x="888" y="777" width="40" height="100" style="fill:brown"/>
</svg>
</div>

<div class="gula1" style="position: absolute; top: -2000px; left: 210px">
  <div class="tien"/>
</div>
</div> <!-- canvas end -->
<div id="ground">
<div id="container">
    <div class="xmasgift">
        <div class="ribbon"></div>
        <div class="ribbonTail"></div>
        <div class="wrapping">
            <div class="cover"></div>
                <p class="message">PF</p>
            <div class="box"></div>
        </div>
    </div>
    <div class="xmasgift" id="d2">
        <div class="ribbon"></div>
        <div class="ribbonTail"></div>
        <div class="wrapping">
            <div class="cover"></div>
                <p class="message">2016</p>
            <div class="box"></div>
        </div>
    </div>
</div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56076886-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
